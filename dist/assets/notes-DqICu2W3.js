const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./web-KQzfY1Vy.js","./isDarkTheme-DnSvkQ-N.js","./theme-CIxG1vPZ.js","./loadingGif-CLxvH4cC.js","./toast-BIaIkxlU.js","./logoutAndDelete-TpS2wTiU.js","./indexedDButils-TR8NEaRF.js","./idb-nMDuyRcf.js"])))=>i.map(i=>d[i]);
import{i as e}from"./isDarkTheme-DnSvkQ-N.js";import{s as t,h as n}from"./loadingGif-CLxvH4cC.js";import{t as o}from"./toast-BIaIkxlU.js";import{l as r}from"./logoutAndDelete-TpS2wTiU.js";import{g as s,s as i,d as a}from"./indexedDButils-TR8NEaRF.js";import"./theme-CIxG1vPZ.js";import"./idb-nMDuyRcf.js";const l={},c=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map((e=>Promise.resolve(e).then((e=>({status:"fulfilled",value:e})),(e=>({status:"rejected",reason:e}))))))};const r=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),i=(null==s?void 0:s.nonce)||(null==s?void 0:s.getAttribute("nonce"));o=e(t.map((e=>{if(e=function(e,t){return new URL(e,t).href}(e,n),e in l)return;l[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(!!n)for(let n=r.length-1;n>=0;n--){const o=r[n];if(o.href===e&&(!t||"stylesheet"===o.rel))return}else if(document.querySelector(`link[href="${e}"]${o}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,i&&s.setAttribute("nonce",i),document.head.appendChild(s),t?new Promise(((t,n)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return o.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))};
/*! Capacitor: https://capacitorjs.com/ - MIT License */
var d,u;(u=d||(d={})).Unimplemented="UNIMPLEMENTED",u.Unavailable="UNAVAILABLE";class m extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const p=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},o=n.Plugins=n.Plugins||{},r=()=>null!==t?t.name:(e=>{var t,n;return(null==e?void 0:e.androidBridge)?"android":(null===(n=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(e),s=e=>{var t;return null===(t=n.PluginHeaders)||void 0===t?void 0:t.find((t=>t.name===e))},i=new Map;return n.convertFileSrc||(n.convertFileSrc=e=>e),n.getPlatform=r,n.handleError=t=>e.console.error(t),n.isNativePlatform=()=>"web"!==r(),n.isPluginAvailable=e=>{const t=i.get(e);return!!(null==t?void 0:t.platforms.has(r()))||!!s(e)},n.registerPlugin=(e,a={})=>{const l=i.get(e);if(l)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),l.proxy;const c=r(),u=s(e);let p;const h=o=>{let r;const s=(...s)=>{const i=(async()=>(!p&&c in a?p=p="function"==typeof a[c]?await a[c]():a[c]:null!==t&&!p&&"web"in a&&(p=p="function"==typeof a.web?await a.web():a.web),p))().then((t=>{const i=((t,o)=>{var r,s;if(!u){if(t)return null===(s=t[o])||void 0===s?void 0:s.bind(t);throw new m(`"${e}" plugin is not implemented on ${c}`,d.Unimplemented)}{const s=null==u?void 0:u.methods.find((e=>o===e.name));if(s)return"promise"===s.rtype?t=>n.nativePromise(e,o.toString(),t):(t,r)=>n.nativeCallback(e,o.toString(),t,r);if(t)return null===(r=t[o])||void 0===r?void 0:r.bind(t)}})(t,o);if(i){const e=i(...s);return r=null==e?void 0:e.remove,e}throw new m(`"${e}.${o}()" is not implemented on ${c}`,d.Unimplemented)}));return"addListener"===o&&(i.remove=async()=>r()),i};return s.toString=()=>`${o.toString()}() { [capacitor code] }`,Object.defineProperty(s,"name",{value:o,writable:!1,configurable:!1}),s},v=h("addListener"),g=h("removeListener"),w=(e,t)=>{const n=v({eventName:e},t),o=async()=>{const o=await n;g({eventName:e,callbackId:o},t)},r=new Promise((e=>n.then((()=>e({remove:o})))));return r.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await o()},r},f=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return u?w:v;case"removeListener":return g;default:return h(t)}}});return o[e]=f,i.set(e,{name:e,proxy:f,platforms:new Set([...Object.keys(a),...u?[c]:[]])}),f},n.Exception=m,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},h=(e=>e.Capacitor=p(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),v=h.registerPlugin;class g{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let n=!1;this.listeners[e]||(this.listeners[e]=[],n=!0),this.listeners[e].push(t);const o=this.windowListeners[e];o&&!o.registered&&this.addWindowListener(o),n&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,n){const o=this.listeners[e];if(o)o.forEach((e=>e(t)));else if(n){let n=this.retainedEventArguments[e];n||(n=[]),n.push(t),this.retainedEventArguments[e]=n}}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new h.Exception(e,d.Unimplemented)}unavailable(e="not available"){return new h.Exception(e,d.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const o=n.indexOf(t);this.listeners[e].splice(o,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach((t=>{this.notifyListeners(e,t)})))}}const w=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),f=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class y extends g{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach((e=>{if(e.length<=0)return;let[n,o]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=f(n).trim(),o=f(o).trim(),t[n]=o})),t}async setCookie(e){try{const t=w(e.key),n=w(e.value),o=`; expires=${(e.expires||"").replace("expires=","")}`,r=(e.path||"/").replace("path=",""),s=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${n||""}${o}; path=${r}; ${s};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}v("CapacitorCookies",{web:()=>new y});const b=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=((e={})=>{const t=Object.keys(e);return Object.keys(e).map((e=>e.toLocaleLowerCase())).reduce(((n,o,r)=>(n[o]=e[t[r]],n)),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[n,o]of Object.entries(e.data||{}))t.set(n,o);n.body=t.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach(((e,n)=>{t.append(n,e)}));else for(const n of Object.keys(e.data))t.append(n,e.data[n]);n.body=t;const o=new Headers(n.headers);o.delete("content-type"),n.headers=o}else(o.includes("application/json")||"object"==typeof e.data)&&(n.body=JSON.stringify(e.data));return n};class E extends g{async request(e){const t=b(e,e.webFetchExtra),n=((e,t=!0)=>e?Object.entries(e).reduce(((e,n)=>{const[o,r]=n;let s,i;return Array.isArray(r)?(i="",r.forEach((e=>{s=t?encodeURIComponent(e):e,i+=`${o}=${s}&`})),i.slice(0,-1)):(s=t?encodeURIComponent(r):r,i=`${o}=${s}`),`${e}&${i}`}),"").substr(1):null)(e.params,e.shouldEncodeUrlParams),o=n?`${e.url}?${n}`:e.url,r=await fetch(o,t),s=r.headers.get("content-type")||"";let i,a,{responseType:l="text"}=r.ok?e:{};switch(s.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":a=await r.blob(),i=await(async e=>new Promise(((t,n)=>{const o=new FileReader;o.onload=()=>{const e=o.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},o.onerror=e=>n(e),o.readAsDataURL(e)})))(a);break;case"json":i=await r.json();break;default:i=await r.text()}const c={};return r.headers.forEach(((e,t)=>{c[t]=e})),{data:i,headers:c,status:r.status,url:r.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}v("CapacitorHttp",{web:()=>new E});const S=v("Network",{web:()=>c((()=>import("./web-KQzfY1Vy.js")),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url).then((e=>new e.NetworkWeb))});async function L(){return(await S.getStatus()).connected}const C=document.querySelector(".refreshNotes"),k=sessionStorage.getItem("selectedBook"),N=parseInt(sessionStorage.getItem("selectedChapter")),P=document.querySelector(".notes-page-title"),$=`Punti notevoli del capitolo ${N} di ${k}`;async function q(){return!!(await L())&&(!(await s("userNotes"))&&(!(await s("userNotes"))||void 0))}P&&(P.textContent=$,window.document.title=`${$} - NotableBiblePoints`);const x=document.querySelector(".modal");async function j(){const t=document.querySelector(".notesContainer");if(t){t.innerHTML="<p>Caricamento in corso...</p>",C.classList.add("disabled");try{const n=localStorage.getItem("userEmail"),r=await q()?(await Backendless.Data.of("NotableBiblePoints").findFirst()).NotablePoints:await s("userNotes");if(console.log(r,"allRecords"),!Array.isArray(r))return o("Errore: i dati non sono in formato corretto."),void(t.innerHTML="<p>Errore nei dati delle note.</p>");const a=Object.values(r).filter((e=>"object"==typeof e&&e.id)),l=a.filter((e=>e.owner===n));console.log(r,a,l),await i("userNotes",l),t.innerHTML="";let c=!1,d=[];Array.isArray(l)&&l.length>0&&(await q()&&await i("userNotes",l),l.forEach((e=>{if(e&&e.book===k&&e.chapter===N&&e.owner===n){c=!0;const{verse:t,title:n="",content:o,id:r}=e;d.push({verse:t,title:n,content:o,noteId:r})}})),d.sort(((e,t)=>e.verse-t.verse)),d.forEach((({verse:n,title:o,content:r,noteId:s})=>{const i=document.createElement("div");i.classList.add("note"),i.setAttribute("data-id",s);const a=e?"../assets/notes/delete/dark.webp":"../assets/notes/delete/light.webp",l=e?"../assets/notes/edit/dark.webp":"../assets/notes/edit/light.webp",c=e?"../assets/notes/share/dark.webp":"../assets/notes/share/light.webp";i.innerHTML=`\n          <div class="verse-number">\n            <h4>Versetto ${n}</h4>\n          </div>\n          <div class="note-body">\n            <h2 class="note-title">${o}</h2>\n            <h3>${r}</h3>\n          </div>\n\n          <div class="note-action-buttons">\n          <button class="delete"><img class="deleteNote_img" src="${a}" width="40px" height="40px"></button>\n          <button class="edit"><img class="edit_img" src="${l}" width="40px" height="40px"></button>\n          <button class="share"><img class="share_img" src="${c}" width="40px" height="40px"></button>\n          </div>\n        `,t.appendChild(i)}))),c||(t.innerHTML="<p>Non hai salvato nessun punto notevole per questo capitolo. Creane uno usando il pulsante in basso a destra con l'icona '+'.</p>")}catch(n){if(n.message.toLowerCase().includes("not existing user token"))return o("Sessione scaduta. Effettua nuovamente il login per continuare."),void r();console.error("Errore nel recupero delle note:",n),o(`Errore: ${n.message}`),t.innerHTML=`<p>Errore nel caricamento delle note. Riprova più tardi.<br>Dettagli: ${n.message}</p>`}finally{document.querySelector("#noteContent").value="",document.querySelector("#noteTitle").value="",document.querySelector("#verseNumber").value="",C.classList.remove("disabled")}}}async function A(){const e=document.querySelector("#noteTitle").value.trim(),r=parseInt(document.querySelector("#verseNumber").value),l=document.querySelector("#noteContent").value.trim();if(!isNaN(r)&&l){x.style.display="none",t();try{const t=localStorage.getItem("userEmail");let n=await L()?await Backendless.Data.of("NotableBiblePoints").findFirst():await s("userNotes");n||(n={NotablePoints:[]});let c=await L()?n.NotablePoints:n;if(T){const t=c.findIndex((e=>e.id===T));if(-1===t)return void o("Errore: impossibile trovare la nota da modificare.");c[t]={...c[t],...e&&{title:e},verse:r,updatedAt:Date.now().toString(),content:l}}else{const n={id:Date.now().toString(),title:e||" ",verse:r,content:l,chapter:parseInt(sessionStorage.getItem("selectedChapter")),book:sessionStorage.getItem("selectedBook"),owner:t};c.push(n)}n.NotablePoints=c,await L()?(await Backendless.Data.of("NotableBiblePoints").save(n),console.log("Nota salvata con successo sul server!")):(await i("userNotes",c.filter((e=>e.owner===t))),console.log("Nota salvata con successo in locale!")),T=null,x.style.display="none",await L()&&(await a("userNotes"),console.log("locale eliminato")),j()}catch(c){console.error("Errore durante il salvataggio/modifica:",c),o("Errore durante il salvataggio. Riprova più tardi.")}finally{document.querySelector("#noteContent").value="",document.querySelector("#noteTitle").value="",document.querySelector("#verseNumber").value="",n()}}else o("Compila tutti i campi correttamente!")}document.querySelector(".openModal").addEventListener("click",(()=>{x.style.display="block"})),document.querySelector(".closeModal").addEventListener("click",(()=>{document.querySelector("#noteContent").value="",document.querySelector("#noteTitle").value="",document.querySelector("#verseNumber").value="",x.style.display="none"})),window.addEventListener("load",j),document.querySelector("#saveNote").addEventListener("click",A),document.addEventListener("click",(e=>{const t=e.target.closest(".note");t&&(t.id="clicked-note",t.requestFullscreen())})),document.addEventListener("fullscreenchange",(()=>{const e=document.fullscreenElement;e&&"clicked-note"===e.id||(document.querySelector("#clicked-note").id="",console.log("Uscito dal fullscreen!"))})),document.querySelector(".notesContainer").addEventListener("click",(e=>{const r=e.target.closest(".note");r&&(e.target.classList.contains("delete")&&async function(e){if(!confirm("Sei sicuro di voler eliminare questa nota?"))return;t(),x.style.display="none";try{const t=e.getAttribute("data-id");if(!t)return void o("Errore: impossibile trovare l'ID della nota.");let n=await L()?await Backendless.Data.of("NotableBiblePoints").findFirst():await s("userNotes");if(console.log(n),await L()&&!n.NotablePoints||!(await L())&&!n)return void o("Errore: impossibile trovare le note dell'utente.");const r=await L()?n.NotablePoints.filter((e=>e.id!==t)):n.filter((e=>e.id!==t));await L()?n.NotablePoints=r:n=r;let a=await s("deletedNotes")||[];const l={id:t};a.push(l),await i("deletedNotes",a),await i("userNotes",r.filter((e=>e.owner===localStorage.getItem("userEmail")))),await L()&&await Backendless.Data.of("NotableBiblePoints").save(n),e.remove(),o("Nota eliminata con successo!")}catch(r){console.error("Errore durante l'eliminazione:",r),o("Errore durante l'eliminazione della nota. Riprova più tardi.")}finally{n()}}(r),e.target.classList.contains("share")&&function(e){const t=e.querySelector(".note-title").textContent,n=e.querySelector(".note-body h3").textContent,r=e.querySelector(".verse-number h4").textContent.replace("Versetto ","").trim(),s=`Ho trovato un punto notevole interessante in ${k} ${N}:${r}: ${n}`;navigator.share?navigator.share({title:`Punto notevole: ${t}`,text:s}).then((()=>console.log("Condivisione avvenuta con successo!"))).catch((e=>console.error("Errore durante la condivisione:",e))):function(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),navigator.clipboard.writeText(),document.body.removeChild(t),o("Il testo della nota è stato copiato negli appunti!")}(s)}(r),e.target.classList.contains("edit")&&async function(e){console.log("Editing note..."),document.fullscreenElement&&document.exitFullscreen();T=e.getAttribute("data-id");const t=e.querySelector(".note-title").textContent.trim(),n=e.querySelector(".note-body h3").textContent.trim(),o=e.querySelector(".verse-number h4").textContent.replace("Versetto ","").trim();document.querySelector("#noteTitle").value=t,document.querySelector("#verseNumber").value=o,document.querySelector("#noteContent").value=n,x.style.display="block"}(r))})),document.addEventListener("keypress",(e=>{"Enter"!==e.key||"noteContent"!==e.target.id||/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||(e.preventDefault(),A())}));let T=null;document.addEventListener("keydown",(function e(t){"Escape"===t.key&&(x.style.display="none",T=null,document.removeEventListener("keydown",e))}));new MutationObserver((()=>{window.setTimeout((()=>{0===document.querySelector(".notesContainer").children.length&&(console.log("Tutte le note sono state eliminate"),document.querySelector(".notesContainer").innerHTML="<p>Non hai salvato nessun punto notevole per questo capitolo. Creane uno usando il pulsante in basso a destra con l'icona '+'.</p>")}),500)})).observe(document.querySelector(".notesContainer"),{childList:!0}),C.addEventListener("click",(async()=>{"false"!==sessionStorage.getItem("canRefresh")&&(await L()&&await a("userNotes"),j())}));const O=["Genesi","Esodo","Levitico","Numeri","Deuteronomio","Giosuè","Giudici","Rut","1 Samuele","2 Samuele","1 Re","2 Re","1 Cronache","2 Cronache","Esdra","Neemia","Ester","Giobbe","Salmi","Proverbi","Ecclesiaste","Cantico dei Cantici","Isaia","Geremia","Lamentazioni","Ezechiele","Daniele","Osea","Gioele","Amos","Abdia","Giona","Michea","Naum","Abacuc","Sofonia","Aggeo","Zaccaria","Malachia","Matteo","Marco","Luca","Giovanni","Atti","Romani","1 Corinti","2 Corinti","Galati","Efesini","Filippesi","Colossesi","1 Tessalonicesi","2 Tessalonicesi","1 Timoteo","2 Timoteo","Tito","Filemone","Ebrei","Giacomo","1 Pietro","2 Pietro","1 Giovanni","2 Giovanni","3 Giovanni","Giuda","Rivelazione"],I=document.querySelector("#readChapter")||null;null==I||I.addEventListener("click",(()=>{const e=sessionStorage.getItem("selectedBook"),t=sessionStorage.getItem("selectedChapter"),n=O.indexOf(e);if(-1!==n){const e=(n+1).toString().padStart(2,"0"),o=`${e}${t.padStart(3,"0")}000-${e}${t.padStart(3,"0")}999}`;I.href=`https://www.jw.org/finder?wtlocale=I&prefer=lang&bible=${o}&pub=nwtsty`}else o("C'è stato un errore nel reindirizzamento. Si prega di riprovare più tardi.")}));export{g as W};
