import{s as e,h as o}from"./loadingGif-CLxvH4cC.js";import{t}from"./toast-BIaIkxlU.js";import{d as a,g as i}from"./indexedDButils-TR8NEaRF.js";import"./idb-nMDuyRcf.js";async function r(){try{const a=await Backendless.UserService.getCurrentUser();if(console.log("Utente attuale:",a),!a)return void t("Nessun utente loggato.");e();if(!confirm("Questa azione Ã¨ irreversibile e cancella tutti i dati associati a questo account. Sei sicuro di voler proseguire ed eliminare il tuo account?"))return void o();const r=await i("userEmail");if(!r)return t("Errore: email utente non trovata."),void o();const l=await Backendless.Data.of("NotableBiblePoints").findFirst();if(!l||!l.NotablePoints)return t("Errore: dati non trovati."),void o();console.log("Dati attuali:",l.NotablePoints);const s=l.NotablePoints.filter((e=>e.owner!==r));console.log("Dati aggiornati:",s),l.NotablePoints=s,await Backendless.Data.of("NotableBiblePoints").save(l),console.log("Eliminazione utente con ID:",a.objectId),await Backendless.Data.of("Users").remove(a.objectId),n(!1)}catch(a){console.error("Errore nella cancellazione dell'account:",a),t("Errore durante l'eliminazione dell'account: "+a.message)}finally{o()}}async function n(i=!1,r=!0){r&&e();try{await Backendless.UserService.logout(),localStorage.removeItem("userEmail"),localStorage.removeItem("userToken"),await a("userNotes"),await a("deletedNotes"),localStorage.removeItem("userNotes"),localStorage.removeItem("deletedNotes"),console.log("reindirizzo a "+(i?"./login.html":"./html/login.html")),window.location.href=i?"./login.html":"./html/login.html"}catch(n){console.error("Errore nel logout:",n),t("Errore durante il logout: "+n.message,4e3)}finally{o()}}async function l(){if("false"===localStorage.getItem("isAuthenticated"))return void(window.location.href="login.html");const e=await new Promise((e=>{let o=0,t=!1;const a=()=>{document.referrer.startsWith(window.location.origin)&&document.referrer!==window.location.href?(t=!0,e(document.referrer)):(o++,o>10?e(null):history.back(),setTimeout((()=>{t||a()}),100))};a()}));e?(console.log("Ritornando a "+e),window.location.href=e):window.location.href="login.html"}export{r as d,n as l,l as r};
