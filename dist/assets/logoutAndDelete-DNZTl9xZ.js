import{B as o}from"./index-C1EFNDRC.js";import{s as e,h as t}from"./loadingGif-CLxvH4cC.js";import{t as i}from"./toast-BIaIkxlU.js";import{d as r,g as a}from"./indexedDButils-TR8NEaRF.js";import"./idb-nMDuyRcf.js";async function n(){try{const r=await o.UserService.getCurrentUser();if(console.log("Utente attuale:",r),!r)return void i("Nessun utente loggato.");e();if(!confirm("Questa azione Ã¨ irreversibile e cancella tutti i dati associati a questo account. Sei sicuro di voler proseguire ed eliminare il tuo account?"))return void t();const n=await a("userEmail");if(!n)return i("Errore: email utente non trovata."),void t();const s=await o.Data.of("NotableBiblePoints").findFirst();if(!s||!s.NotablePoints)return i("Errore: dati non trovati."),void t();console.log("Dati attuali:",s.NotablePoints);const c=s.NotablePoints.filter((o=>o.owner!==n));console.log("Dati aggiornati:",c),s.NotablePoints=c,await o.Data.of("NotableBiblePoints").save(s),console.log("Eliminazione utente con ID:",r.objectId),await o.Data.of("Users").remove(r.objectId),l(!1)}catch(r){console.error("Errore nella cancellazione dell'account:",r),i("Errore durante l'eliminazione dell'account: "+r.message)}finally{t()}}async function l(a=!1,n=!0){n&&e();try{await o.UserService.logout(),localStorage.removeItem("userEmail"),localStorage.removeItem("userToken"),await r("userNotes"),await r("deletedNotes"),localStorage.removeItem("userNotes"),localStorage.removeItem("deletedNotes"),console.log("reindirizzo a "+(a?"./login.html":"./html/login.html")),window.location.href=a?"./login.html":"./html/login.html"}catch(l){console.error("Errore nel logout:",l),i("Errore durante il logout: "+l.message,4e3)}finally{t()}}async function s(){if("false"===localStorage.getItem("isAuthenticated"))return void(window.location.href="login.html");const o=await new Promise((o=>{let e=0,t=!1;const i=()=>{document.referrer.startsWith(window.location.origin)&&document.referrer!==window.location.href?(t=!0,o(document.referrer)):(e++,e>10?o(null):history.back(),setTimeout((()=>{t||i()}),100))};i()}));o?(console.log("Ritornando a "+o),window.location.href=o):window.location.href="login.html"}export{n as d,l,s as r};
