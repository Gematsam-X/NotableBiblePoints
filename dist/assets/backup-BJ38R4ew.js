import{s as e,h as t}from"./loadingGif-CLxvH4cC.js";import{t as o}from"./toast-BIaIkxlU.js";import{g as i,s as n}from"./indexedDButils-TR8NEaRF.js";import{i as a}from"./isOnline-DgpNA9Wq.js";import"./idb-nMDuyRcf.js";async function s(){e();const n=await async function(){const e=(await Backendless.Data.of("NotableBiblePoints").findFirst()).NotablePoints.filter((e=>e.owner==localStorage.getItem("userEmail")))||await i("userNotes");return e?(console.log("Dati attuali:",e),e):(o("Errore: dati non trovati."),[])}();if(!n.length)return o("Non hai ancora salvato nessun punto notevole."),void t();const a=localStorage.getItem("userEmail");if(!n.length)return o("Nessun dato disponibile per l'utente corrente."),void t();let s=JSON.stringify(n,null,4),r=new Blob([s],{type:"application/json"}),l=URL.createObjectURL(r);const c=new Date;let u=`NotableBiblePointsBACKUP_${a}_${String(c.getDate()).padStart(2,"0")}-${String(c.getMonth()+1).padStart(2,"0")}-${c.getFullYear()}.nbp`,d=document.createElement("a");d.href=l,d.download=u,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l),t(),o("Backup scaricato con successo. Tienilo in un posto sicuro: non è possibile recuperarlo se lo perdi.")}let r=null;async function l(){const s=document.getElementById("fileInput");s?(s.accept=".nbp",s.addEventListener("change",(async function(s){const l=s.target.files[0];if(!l)return void o("Per favore, seleziona un file JSON.");e();const c=new FileReader;c.onload=async function(e){try{if(r=JSON.parse(e.target.result),!Array.isArray(r))return void o("Il file di backup è corrotto. Non è possibile ripristinarlo.");const t=localStorage.getItem("userEmail");if(!t)return void o("Utente non autenticato.");let s=await a()?await Backendless.Data.of("NotableBiblePoints").findFirst():await i("userNotes");s||(s={NotablePoints:[]});let l=await a?s.NotablePoints:s;for(const e of r){const o=l.findIndex((t=>t.id===e.id));-1!==o?l[o]={...l[o],...e,updatedAt:Date.now().toString()}:l.push({...e,owner:t})}s.NotablePoints=l,await a()?(await Backendless.Data.of("NotableBiblePoints").save(s),console.log("Backup ripristinato con successo sul server!")):(await n("userNotes",l.filter((e=>e.owner===t))),console.log("Backup ripristinato con successo in locale!")),o("Backup ripristinato con successo.")}catch(s){console.error("Errore nel parsing del file JSON:",s),o("Errore nel parsing del file di backup. Assicurati che il file sia valido.")}finally{t()}},c.readAsText(l)})),s.click()):o("Elemento di input file non trovato.")}export{s as c,l as r};
