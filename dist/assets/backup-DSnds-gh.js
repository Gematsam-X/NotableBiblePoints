import{B as t}from"./index-C1EFNDRC.js";import{s as e,h as o}from"./loadingGif-CLxvH4cC.js";import{t as i}from"./toast-BIaIkxlU.js";import{g as n,s as a}from"./indexedDButils-TR8NEaRF.js";import{i as r}from"./isOnline-C8sKgvuD.js";import"./idb-nMDuyRcf.js";async function s(){e();const a=await async function(){const e=(await t.Data.of("NotableBiblePoints").findFirst()).NotablePoints.filter((t=>t.owner==localStorage.getItem("userEmail")))||await n("userNotes");return e?(console.log("Dati attuali:",e),e):(i("Errore: dati non trovati."),[])}();if(!a.length)return i("Non hai ancora salvato nessun punto notevole."),void o();const r=localStorage.getItem("userEmail");if(!a.length)return i("Nessun dato disponibile per l'utente corrente."),void o();let s=JSON.stringify(a,null,4),l=new Blob([s],{type:"application/json"}),c=URL.createObjectURL(l);const u=new Date;let d=`NotableBiblePointsBACKUP_${r}_${String(u.getDate()).padStart(2,"0")}-${String(u.getMonth()+1).padStart(2,"0")}-${u.getFullYear()}.nbp`,p=document.createElement("a");p.href=c,p.download=d,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(c),o(),i("Backup scaricato con successo. Tienilo in un posto sicuro: non è possibile recuperarlo se lo perdi.")}let l=null;async function c(){const s=document.getElementById("fileInput");s?(s.accept=".nbp",s.addEventListener("change",(async function(s){const c=s.target.files[0];if(!c)return void i("Per favore, seleziona un file JSON.");e();const u=new FileReader;u.onload=async function(e){try{if(l=JSON.parse(e.target.result),!Array.isArray(l))return void i("Il file di backup è corrotto. Non è possibile ripristinarlo.");const o=localStorage.getItem("userEmail");if(!o)return void i("Utente non autenticato.");let s=await r()?await t.Data.of("NotableBiblePoints").findFirst():await n("userNotes");s||(s={NotablePoints:[]});let c=await r?s.NotablePoints:s;for(const t of l){const e=c.findIndex((e=>e.id===t.id));-1!==e?c[e]={...c[e],...t,updatedAt:Date.now().toString()}:c.push({...t,owner:o})}s.NotablePoints=c,await r()?(await t.Data.of("NotableBiblePoints").save(s),console.log("Backup ripristinato con successo sul server!")):(await a("userNotes",c.filter((t=>t.owner===o))),console.log("Backup ripristinato con successo in locale!")),i("Backup ripristinato con successo.")}catch(s){console.error("Errore nel parsing del file JSON:",s),i("Errore nel parsing del file di backup. Assicurati che il file sia valido.")}finally{o()}},u.readAsText(c)})),s.click()):i("Elemento di input file non trovato.")}export{s as c,c as r};
