import e from"./toast.js";import{showGif as o,hideGif as r}from"./loadingGif.js";const t=document.querySelector(".modal");document.querySelector("#recovery").addEventListener("click",(()=>{t.style.display="block"})),document.querySelector(".closeModal").addEventListener("click",(()=>{t.style.display="none",document.querySelector("#emailForRecovery").value=""})),document.querySelector("#recoveryBtn").addEventListener("click",(async a=>{a.preventDefault(),async function(){const a=document.querySelector("#emailForRecovery").value.trim();if(!a)return void e("Inserisci la mail con la quale ti sei registrato su NotableBiblePoints. Se non hai ancora effettuato la registrazione, puoi farlo accedendo all'apposita sezione chiudendo questa finestra.",4100);o();try{const o=Backendless.DataQueryBuilder.create().setWhereClause(`email = '${a}'`),r=await Backendless.Data.of("Users").find(o);if(!r||0===r.length)return t.style.display="none",document.querySelector("#emailForRecovery").value="",void e("Nessun utente trovato con questa email. Puoi registrarti accedendo all'apposita sezione chiudendo questa finestra.",3400);const l=r[0];console.log("Utente trovato:",l),await Backendless.UserService.restorePassword(a),t.style.display="none",document.querySelector("#emailForRecovery").value="",e("Ti è stata inviata un'email per il recupero della password. Clicca sul link contenuto nella mail per procedere.")}catch(o){console.error("Errore durante il recupero dell'utente:",o),e("Si è verificato un errore. Riprova più tardi.",4100)}finally{r()}}()}));